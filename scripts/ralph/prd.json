{
  "project": "Docklight",
  "branchName": "ralph/app-settings",
  "description": "Comprehensive app settings and enhanced creation: add ports/proxy, buildpacks, Docker options, network, and deployment settings management to the App Detail page, plus advanced options in the Create App dialog.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Ports management API endpoints",
      "description": "As a developer, I need server endpoints to list, add, and remove port mappings so the frontend can manage how traffic reaches containers.",
      "acceptanceCriteria": [
        "Create server/lib/ports.ts with getPorts(name) that runs 'dokku ports:report <name>' and parses port mappings into { scheme: string, hostPort: number, containerPort: number }[]",
        "Add addPort(name, scheme, hostPort, containerPort) that runs 'dokku ports:add <name> <scheme>:<hostPort>:<containerPort>'",
        "Add removePort(name, scheme, hostPort, containerPort) that runs 'dokku ports:remove <name> <scheme>:<hostPort>:<containerPort>'",
        "Add clearPorts(name) that runs 'dokku ports:clear <name>'",
        "Add routes in server/index.ts: GET /api/apps/:name/ports, POST /api/apps/:name/ports, DELETE /api/apps/:name/ports, DELETE /api/apps/:name/ports/all",
        "Validate app name with isValidAppName() and port values in range 1-65535",
        "Clear cache after mutations",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Proxy management API endpoints",
      "description": "As a developer, I need server endpoints to view and toggle the proxy configuration for an app.",
      "acceptanceCriteria": [
        "Add getProxyReport(name) in server/lib/ports.ts that runs 'dokku proxy:report <name>' and parses enabled status and proxy type",
        "Add enableProxy(name) that runs 'dokku proxy:enable <name>'",
        "Add disableProxy(name) that runs 'dokku proxy:disable <name>'",
        "Add routes in server/index.ts: GET /api/apps/:name/proxy, POST /api/apps/:name/proxy/enable, POST /api/apps/:name/proxy/disable",
        "Validate app name with isValidAppName()",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Buildpacks management API endpoints",
      "description": "As a developer, I need server endpoints to list, add, remove, and clear buildpacks for an app.",
      "acceptanceCriteria": [
        "Create server/lib/buildpacks.ts with getBuildpacks(name) that runs 'dokku buildpacks:report <name>' and parses buildpack list into { index: number, url: string }[]",
        "Add addBuildpack(name, url, index?) that runs 'dokku buildpacks:add <name> <url>' with optional '--index <n>'",
        "Add removeBuildpack(name, url) that runs 'dokku buildpacks:remove <name> <url>'",
        "Add clearBuildpacks(name) that runs 'dokku buildpacks:clear <name>'",
        "Add routes in server/index.ts: GET /api/apps/:name/buildpacks, POST /api/apps/:name/buildpacks, DELETE /api/apps/:name/buildpacks, DELETE /api/apps/:name/buildpacks/all",
        "Validate app name with isValidAppName()",
        "Clear cache after mutations",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Docker Options management API endpoints",
      "description": "As a developer, I need server endpoints to manage Docker options (build/deploy/run phase arguments) for an app.",
      "acceptanceCriteria": [
        "Create server/lib/docker-options.ts with getDockerOptions(name) that runs 'dokku docker-options:report <name>' and parses options grouped by phase into { build: string[], deploy: string[], run: string[] }",
        "Add addDockerOption(name, phase, option) that runs 'dokku docker-options:add <name> <phase> \"<option>\"'",
        "Add removeDockerOption(name, phase, option) that runs 'dokku docker-options:remove <name> <phase> \"<option>\"'",
        "Add clearDockerOptions(name, phase) that runs 'dokku docker-options:clear <name> <phase>'",
        "Add routes in server/index.ts: GET /api/apps/:name/docker-options, POST /api/apps/:name/docker-options, DELETE /api/apps/:name/docker-options, DELETE /api/apps/:name/docker-options/all",
        "Validate phase is one of: build, deploy, run",
        "Validate app name with isValidAppName()",
        "Clear cache after mutations",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Network configuration API endpoints",
      "description": "As a developer, I need server endpoints to view and configure network settings for an app.",
      "acceptanceCriteria": [
        "Create server/lib/network.ts with getNetworkReport(name) that runs 'dokku network:report <name>' and parses properties: attach-post-create, attach-post-deploy, bind-all-interfaces, initial-network, static-web-listener, tls-internal",
        "Add setNetworkProperty(name, key, value) that runs 'dokku network:set <name> <key> <value>'",
        "Add clearNetworkProperty(name, key) that runs 'dokku network:set <name> <key>' with empty value",
        "Add routes in server/index.ts: GET /api/apps/:name/network, PUT /api/apps/:name/network",
        "Validate property key is one of the known network properties",
        "Validate app name with isValidAppName()",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Deployment settings API endpoints",
      "description": "As a developer, I need server endpoints to manage git deployment settings (deploy branch, build directory, builder) for an app.",
      "acceptanceCriteria": [
        "Create server/lib/deployment.ts with getDeploymentSettings(name) that runs 'dokku git:report <name>' and 'dokku builder:report <name>', parsing deploy-branch, build-dir, and selected builder",
        "Add setDeployBranch(name, branch) that runs 'dokku git:set <name> deploy-branch <branch>'",
        "Add setBuildDir(name, dir) that runs 'dokku builder:set <name> build-dir <dir>'",
        "Add clearBuildDir(name) that runs 'dokku builder:set <name> build-dir' with empty value",
        "Add setBuilder(name, builder) that runs 'dokku builder:set <name> selected <builder>'",
        "Add routes in server/index.ts: GET /api/apps/:name/deployment, PUT /api/apps/:name/deployment",
        "Validate builder is one of: herokuish, dockerfile, pack, or empty string for auto-detect",
        "Validate app name with isValidAppName()",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Zod schemas for new settings APIs",
      "description": "As a developer, I need client-side Zod schemas for all new settings API responses so apiFetch can validate them.",
      "acceptanceCriteria": [
        "Add PortMappingSchema: z.object({ scheme: z.string(), hostPort: z.number(), containerPort: z.number() })",
        "Add PortsResponseSchema: z.object({ ports: z.array(PortMappingSchema) })",
        "Add ProxyReportSchema: z.object({ enabled: z.boolean(), type: z.string() })",
        "Add BuildpackSchema: z.object({ index: z.number(), url: z.string() })",
        "Add BuildpacksResponseSchema: z.object({ buildpacks: z.array(BuildpackSchema) })",
        "Add DockerOptionsSchema: z.object({ build: z.array(z.string()), deploy: z.array(z.string()), run: z.array(z.string()) })",
        "Add NetworkReportSchema: z.record(z.string(), z.string())",
        "Add DeploymentSettingsSchema: z.object({ deployBranch: z.string(), buildDir: z.string(), builder: z.string() })",
        "All schemas added to client/src/lib/schemas.ts with exported types",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Settings tab structure in AppDetail",
      "description": "As a developer, I need to add the Settings tab to AppDetail with a sectioned layout for the settings panels.",
      "acceptanceCriteria": [
        "Add 'settings' to the TabType union in AppDetail.tsx",
        "Add 'Settings' tab button in the tab bar after SSL tab",
        "Settings tab renders a vertically stacked layout with placeholder sections: Deployment, Ports & Proxy, Buildpacks, Docker Options, Network",
        "Each section uses a Card component with a section title",
        "Data fetches lazily when Settings tab becomes active",
        "Follow existing loading/error state patterns",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Deployment settings panel on App Detail",
      "description": "As a user, I want to configure deploy branch, build directory, and builder from the Settings tab.",
      "acceptanceCriteria": [
        "Within the Settings tab, the Deployment section fetches GET /api/apps/:name/deployment on mount",
        "Deploy Branch field: text input showing current branch with save button",
        "Build Directory field: text input for monorepo subfolder path with help text 'Set a subdirectory to deploy from when using a monorepo' and clear button",
        "Builder selector: dropdown with options Auto-detect, Herokuish, Dockerfile, Pack",
        "Save calls PUT /api/apps/:name/deployment with changed fields",
        "Show success/error toast after save",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Ports & Proxy settings panel on App Detail",
      "description": "As a user, I want to view and manage port mappings and proxy settings from the Settings tab.",
      "acceptanceCriteria": [
        "Within the Settings tab, the Ports & Proxy section fetches GET /api/apps/:name/ports and GET /api/apps/:name/proxy on mount",
        "Display current port mappings in a table: Scheme | Host Port | Container Port | Remove button",
        "Add Port Mapping form with scheme dropdown (http/https), host port input, container port input",
        "Clear All Ports button with confirmation dialog",
        "Proxy toggle: show current status (enabled/disabled) with enable/disable button",
        "Show proxy type as read-only info",
        "Show success/error toast after each action",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Buildpacks settings panel on App Detail",
      "description": "As a user, I want to manage buildpacks from the Settings tab.",
      "acceptanceCriteria": [
        "Within the Settings tab, the Buildpacks section fetches GET /api/apps/:name/buildpacks on mount",
        "Display current buildpacks as an ordered list with index numbers",
        "Add Buildpack input with URL field and optional index number",
        "Remove button next to each buildpack entry",
        "Clear All button with confirmation dialog",
        "Empty state when no custom buildpacks are set showing 'Auto-detected'",
        "Show success/error toast after each action",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Docker Options settings panel on App Detail",
      "description": "As a user, I want to manage Docker runtime options from the Settings tab.",
      "acceptanceCriteria": [
        "Within the Settings tab, the Docker Options section fetches GET /api/apps/:name/docker-options on mount",
        "Display options grouped by phase (Build, Deploy, Run) as subsections",
        "Each option shows the full Docker flag in monospace font with a remove button",
        "Add Option form with phase dropdown (build/deploy/run) and option text input with placeholder examples",
        "Clear Phase button per phase section with confirmation",
        "Show success/error toast after each action",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Network settings panel on App Detail",
      "description": "As a user, I want to view and configure network settings from the Settings tab.",
      "acceptanceCriteria": [
        "Within the Settings tab, the Network section fetches GET /api/apps/:name/network on mount",
        "Display network properties as a key-value list: attach-post-create, attach-post-deploy, bind-all-interfaces, initial-network, static-web-listener, tls-internal",
        "Each property shows current value or 'not set' with inline edit and clear actions",
        "Inline editing: click value to edit, save/cancel buttons appear",
        "Save calls PUT /api/apps/:name/network with { key, value }",
        "Show success/error toast after save",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Enhanced Create App dialog with Advanced Options",
      "description": "As a user, I want to optionally configure deployment settings during app creation so I can set up monorepo paths upfront.",
      "acceptanceCriteria": [
        "Add a collapsible 'Advanced Options' section below the app name input in CreateAppDialog",
        "Section is collapsed by default, toggle with chevron and 'Advanced Options' label",
        "Advanced Options include: Deploy Branch text input, Build Directory text input with help text 'For monorepo: path to subdirectory (e.g., apps/api)', Builder dropdown (Auto-detect/Herokuish/Dockerfile/Pack)",
        "On create, call POST /api/apps first, then apply non-default advanced settings via PUT /api/apps/:name/deployment",
        "If advanced settings fail, still show app as created but display a warning about which settings failed",
        "Existing name-only flow works identically when advanced section is collapsed",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    }
  ]
}
