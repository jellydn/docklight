## Codebase Patterns
- Example: Use `executeCommand` from executor.ts for all Dokku CLI commands
- Example: Always validate with `isValidAppName()` before executing commands
- Example: Return error objects with { error, command, exitCode, stderr } for error cases
- Example: Clear cache with `clearPrefix('apps:')` after mutations
- Example: Validate phase parameter (build/deploy/run) in docker-options and similar modules
- Example: Use optional chain (?.) when accessing regex match groups to satisfy lint

# Ralph Progress Log
Started: Sat Feb 28 18:28:47 +08 2026
## [Date/Time] - US-001
- Implemented Ports management API endpoints (server/lib/ports.ts, server/index.ts)
- Created getPorts, addPort, removePort, clearPorts functions
- Added routes: GET /api/apps/:name/ports, POST /api/apps/:name/ports, DELETE /api/apps/:name/ports, DELETE /api/apps/:name/ports/all
- Validates app name with isValidAppName() and port values in range 1-65535
- Clears cache after mutations
- Typecheck and lint pass
- Files changed: server/lib/ports.ts (new), server/index.ts
- **Learnings for future iterations:**
  - Follow same pattern as domains.ts for consistency
  - Use stripAnsi() from ansi.ts to clean CLI output
  - Test failures are pre-existing (vi.mocked not a function issue) - not caused by this change
---
## Sat Feb 28 2026 - US-004, US-005, US-006
[Session: https://opncd.ai/s/5cfeab3c]
- Implemented CreateAppDialog component (client/src/components/CreateAppDialog.tsx)
- Added Create App button to Dashboard (client/src/pages/Dashboard.tsx)
- Implemented inline validation for app name (regex: /^[a-z0-9-]+$/)
- Added Next Steps view after app creation with git remote instructions
- Added Copy button for git remote command
- Added Go to App button that navigates to /apps/:name
- Typecheck and lint pass
- Files changed: client/src/components/CreateAppDialog.tsx, client/src/pages/Dashboard.tsx
- **Learnings for future iterations:**
  - Use CommandResultSchema from lib/schemas.ts when calling apiFetch for POST/PUT/DELETE operations
  - Dialog can transition between different views (creation form -> next steps) by using state
  - Reset dialog state when closing to avoid stale data on next open
---

## Sat Feb 28 2026 - US-001
[Session: https://opncd.ai/s/5cfeab3c]
- Implemented Create App API endpoint (server/lib/apps.ts, server/index.ts)
- Added `createApp(name)` function that runs `dokku apps:create <name>`
- Added POST /api/apps route that accepts { name: string }
- Added name validation using existing isValidAppName()
- Added cache clearing (clearPrefix('apps:')) after creation
- Files changed: server/lib/apps.ts, server/index.ts
- **Learnings for future iterations:**
  - The codebase follows a consistent pattern: validation first, then executeCommand, then return result
  - Cache clearing is important for consistency - always call clearPrefix('apps:') after app mutations
  - Test failures are pre-existing (vi.mocked not a function issue) - not caused by this change
---

## Sat Feb 28 2026 - US-002
[Session: https://opncd.ai/s/5cfeab3c]
- Implemented Destroy App API endpoint (server/lib/apps.ts, server/index.ts)
- Added `destroyApp(name, confirmName)` function that runs `dokku apps:destroy <name> --force`
- Added DELETE /api/apps/:name route that accepts { confirmName: string }
- Added validation to ensure confirmName matches name before executing
- Added cache clearing (clearPrefix('apps:')) after destruction
- Files changed: server/lib/apps.ts, server/index.ts
- **Learnings for future iterations:**
  - The destroy endpoint requires typing the app name for confirmation - this is a safety feature
  - The endpoint returns CommandResult which includes exitCode, stdout, stderr
  - Typecheck and lint pass without issues
---

## Sat Feb 28 2026 - US-003
[Session: https://opncd.ai/s/5cfeab3c]
- Implemented Stop and Start App API endpoints (server/lib/apps.ts, server/index.ts)
- Added `stopApp(name)` function that runs `dokku ps:stop <name>`
- Added `startApp(name)` function that runs `dokku ps:start <name>`
- Added POST /api/apps/:name/stop route
- Added POST /api/apps/:name/start route
- Both endpoints validate app name with isValidAppName()
- Both clear apps cache after each action
- Files changed: server/lib/apps.ts, server/index.ts
- **Learnings for future iterations:**
  - Follow the same pattern as restartApp and rebuildApp for consistency
  - Typecheck and lint pass
  - Test failures are pre-existing (vi.mocked not a function issue)
---

## Sat Feb 28 2026 - US-007
[Session: https://opncd.ai/s/5cfeab3c]
- Implemented Dedicated Apps listing page (client/src/pages/Apps.tsx)
- Replaced Navigate redirect with full apps listing page
- Shows table with Name, Status, Domains, Last Deploy columns
- Added 'Create App' button in page header
- App names link to /apps/:name detail page
- Empty state with friendly message and CTA button to open CreateAppDialog
- Loading spinner while fetching
- Error state with message if API fails
- Typecheck and lint pass
- Files changed: client/src/pages/Apps.tsx, scripts/ralph/prd.json
- **Learnings for future iterations:**
  - Reused Dashboard pattern for apps table layout and styling
  - Used same AppSchema and apiFetch patterns as Dashboard
  - Test failures are pre-existing (document not defined issue in test environment)
  - ChromeDevTools MCP not configured - skipped browser verification
---

## Sat Feb 28 2026 - US-008
[Session: https://opncd.ai/s/5cfeab3c]
- Implemented Destroy App from App Detail page (client/src/pages/AppDetail.tsx)
- Added Danger Zone section at bottom of Overview tab with red border styling
- Delete App button opens confirmation dialog requiring type-to-confirm
- Delete button disabled until typed name matches exactly
- On success, navigates to /apps and shows success toast
- On error, shows error message in the dialog
- Typecheck and lint pass
- Files changed: client/src/pages/AppDetail.tsx
- **Learnings for future iterations:**
  - Reused existing dialog patterns in AppDetail.tsx (actionDialog, scaleDialog, removeDialog)
  - Used navigate hook from react-router-dom for navigation after deletion
  - Used existing ToastProvider for success/error notifications
  - Pre-existing test failures in client tests (document not defined)
---

## Sat Feb 28 2026 - US-009
[Session: https://opncd.ai/s/5cfeab3c]
- Implemented Stop and Start controls on App Detail page (client/src/pages/AppDetail.tsx)
- Added 'Stop' button visible when app status is 'running' with orange styling
- Added 'Start' button visible when app status is 'stopped' with green styling
- Added confirmation dialog for Stop action before executing
- Buttons call POST /api/apps/:name/stop or /start respectively
- Show loading state (Stopping.../Starting...) during the action
- Refresh app detail after action completes
- Show success/error toast notification using existing ToastProvider
- Typecheck and lint pass
- Files changed: client/src/pages/AppDetail.tsx
- **Learnings for future iterations:**
  - Reused existing dialog patterns (showDeleteDialog, confirmDeleteApp pattern) for consistency
  - Stop confirmation dialog explains the app will not serve requests until started again
  - ChromeDevTools MCP not configured - skipped browser verification
---

## Sat Feb 28 2026 - US-010
- Fixed CreateAppDialog Zod validation error on success (client/src/components/CreateAppDialog.tsx, client/src/lib/schemas.ts)
- Added CreateAppResultSchema in schemas.ts (z.object({ success: z.boolean(), name: z.string() }))
- Updated CreateAppDialog to use CreateAppResultSchema instead of CommandResultSchema for POST /api/apps call
- Typecheck and lint pass
- Files changed: client/src/components/CreateAppDialog.tsx, client/src/lib/schemas.ts, scripts/ralph/prd.json
- **Learnings for future iterations:**
  - POST /api/apps returns { success, name } but other endpoints return CommandResult - need different schemas
  - ChromeDevTools MCP not configured - skipped browser verification
---

## Sat Feb 28 2026 - US-011
[Session: https://opncd.ai/s/5cfeab3c]
- Fixed unconditional cache clearing on destroy/stop/start endpoints (server/index.ts)
- DELETE /api/apps/:name now only calls clearPrefix('apps:') when result.exitCode === 0
- POST /api/apps/:name/stop now only calls clearPrefix('apps:') when result.exitCode === 0
- POST /api/apps/:name/start now only calls clearPrefix('apps:') when result.exitCode === 0
- On failure, returns appropriate HTTP status code (400-599) and error response
- Typecheck and lint pass
- Files changed: server/index.ts
- **Learnings for future iterations:**
  - Follow same pattern as POST /api/apps (create app) endpoint for consistency
  - Use exitCode >= 400 && exitCode < 600 to determine if it's an HTTP error code
  - Pre-existing test failures (vi.mocked not a function issue) - not caused by this change
---

## Sat Feb 28 2026 - US-012
[Session: https://opncd.ai/s/5cfeab3c]
- Fixed copy button to copy full git remote command (client/src/components/CreateAppDialog.tsx)
- Copy button now copies 'git remote add dokku dokku@<host>:<app>' instead of just 'dokku@<host>:<app>'
- Typecheck and lint pass
- Files changed: client/src/components/CreateAppDialog.tsx
- **Learnings for future iterations:**
  - ChromeDevTools MCP not configured - skipped browser verification
---

## Sat Feb 28 2026 - US-002
- Implemented Proxy management API endpoints (server/lib/ports.ts, server/index.ts)
- Added getProxyReport(name) that runs 'dokku proxy:report <name>' and parses enabled status and proxy type
- Added enableProxy(name) that runs 'dokku proxy:enable <name>'
- Added disableProxy(name) that runs 'dokku proxy:disable <name>'
- Added routes: GET /api/apps/:name/proxy, POST /api/apps/:name/proxy/enable, POST /api/apps/:name/proxy/disable
- Validates app name with isValidAppName()
- Typecheck and lint pass
- Files changed: server/lib/ports.ts, server/index.ts
- **Learnings for future iterations:**
  - Follow same pattern as ports.ts functions for consistency
  - Use stripAnsi() to clean CLI output
  - ProxyReport interface: { enabled: boolean, type: string }
---

## [Date/Time] - US-003
- Implemented Buildpacks management API endpoints (server/lib/buildpacks.ts, server/index.ts)
- Created getBuildpacks, addBuildpack, removeBuildpack, clearBuildpacks functions
- Added routes: GET /api/apps/:name/buildpacks, POST /api/apps/:name/buildpacks, DELETE /api/apps/:name/buildpacks, DELETE /api/apps/:name/buildpacks/all
- Validates app name with isValidAppName()
- Added optional index parameter for addBuildpack with --index flag
- Clear cache after mutations (only on success)
- Typecheck and lint pass
- Files changed: server/lib/buildpacks.ts (new), server/index.ts
- **Learnings for future iterations:**
  - Follow same pattern as ports.ts for consistency
  - Use stripAnsi() to clean CLI output
  - Cache clearing only happens on successful operations (exitCode === 0)
  - Buildpack index is 1-based in Dokku CLI output
---

## Sat Feb 28 2026 - US-004
[Session: https://opncd.ai/s/5cfeab3c]
- Implemented Docker Options management API endpoints (server/lib/docker-options.ts, server/index.ts)
- Created getDockerOptions, addDockerOption, removeDockerOption, clearDockerOptions functions
- Added routes: GET /api/apps/:name/docker-options, POST /api/apps/:name/docker-options, DELETE /api/apps/:name/docker-options, DELETE /api/apps/:name/docker-options/all
- Validates phase is one of: build, deploy, run
- Validates app name with isValidAppName()
- Clear cache after mutations (only on success)
- Typecheck and lint pass
- Files changed: server/lib/docker-options.ts (new), server/index.ts
- **Learnings for future iterations:**
  - Follow same pattern as buildpacks.ts for consistency
  - Use stripAnsi() to clean CLI output
  - Use optional chain (?.) when accessing regex match groups to satisfy biome lint
  - Docker options are space-separated in the CLI output
---

## [Date/Time] - US-005
- Implemented Network configuration API endpoints (server/lib/network.ts, server/index.ts)
- Created getNetworkReport, setNetworkProperty, clearNetworkProperty functions
- Added routes: GET /api/apps/:name/network, PUT /api/apps/:name/network, DELETE /api/apps/:name/network
- Validates app name with isValidAppName()
- Validates network property key against known properties: attach-post-create, attach-post-deploy, bind-all-interfaces, initial-network, static-web-listener, tls-internal
- Clear cache after mutations (only on success)
- Typecheck and lint pass
- Files changed: server/lib/network.ts (new), server/index.ts
- **Learnings for future iterations:**
  - Follow same pattern as buildpacks.ts and docker-options.ts for consistency
  - Use stripAnsi() to clean CLI output
  - Network properties are hyphenated in Dokku CLI (convert to camelCase for JS object keys)
---

## [Date/Time] - US-006
- Implemented Deployment settings API endpoints (server/lib/deployment.ts, server/index.ts)
- Created getDeploymentSettings, setDeployBranch, setBuildDir, clearBuildDir, setBuilder functions
- Added routes: GET /api/apps/:name/deployment, PUT /api/apps/:name/deployment
- GET /api/apps/:name/deployment runs both dokku git:report and dokku builder:report in parallel
- PUT /api/apps/:name/deployment handles deployBranch, buildDir, and builder as optional fields
- Validates app name with isValidAppName()
- Validates builder is one of: herokuish, dockerfile, pack, or empty string for auto-detect
- Clear cache after mutations (only on success)
- Typecheck and lint pass
- Files changed: server/lib/deployment.ts (new), server/index.ts
- **Learnings for future iterations:**
  - Use Promise.all to run independent commands in parallel for better performance
  - Builder value of empty string means auto-detect
  - Build dir cleared by passing empty string or null
---

## [Date/Time] - US-007
- Implemented Zod schemas for new settings APIs (client/src/lib/schemas.ts)
- Added PortMappingSchema and PortsResponseSchema
- Added ProxyReportSchema
- Added BuildpackSchema and BuildpacksResponseSchema
- Added DockerOptionsSchema
- Added NetworkReportSchema
- Added DeploymentSettingsSchema
- All schemas exported with proper TypeScript types
- Typecheck and lint pass
- Files changed: client/src/lib/schemas.ts